# AI結果をペンレイヤーに書き込む設計変更

## アーロン様のブリリアントなアイデア

**問題:** AI結果を c1_base に書き込むと、既存の差分抽出結果が失われる

**解決策:** AI結果を c1p （ペンレイヤー）に書き込む

---

## メリット

### 1. 🎨 ハイブリッド使用が可能
```
c1_final = max(c1_base, c1p) - c1k

c1_base: 既存の差分抽出結果
c1p:     AI抽出結果（ペンとして扱う）
c1k:     手動マスク（削除）
```

- **既存の差分抽出**と**AI抽出**が自動的に統合される
- 両方の良いところを組み合わせられる

### 2. 👁️ AI結果を可視化できる
- 「ペン」表示をオンにすることで、AI抽出結果を確認できる
- どこが抽出されたか一目瞭然

### 3. ✏️ 手動編集が可能
- AI抽出後も、ペンで追加可能
- マスクで削除も可能
- 完全に自由な編集フロー

### 4. 🔄 既存システムとの互換性
- c1_base は既存の差分抽出用に残る
- 既存のワークフローを壊さない

---

## 実装詳細（抜粋）

 AI結果をペンレイヤー（c1p）に直接書き込み、既存の差分抽出（c1_base）と `max` 演算で合成する。

---

## まとめ

 AI抽出と既存システムが完全に統合され、柔軟で直感的なワークフローが実現されました。
